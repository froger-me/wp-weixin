jQuery(function(a){a(document).ready(function(){a(".wechat-scan-result").length&&a("#wpadminbar").remove(),a('#wp_weixin_oa_subscribe input[type="button"]').on("click",function(e){e.preventDefault(),window.location.reload(!0)}),a(".wx-unbind").on("click",function(e){e.preventDefault();var i=a(this),n={userid:a("#wp_weixin_user_id").val(),openid:a("#wp_weixin_openid").val(),nonce:a("#wp_weixin_unbind_nonce").val(),action:"wp_weixin_unbind"};i.attr("disabled","disabled"),a.ajax({url:WP_Weixin.ajax_url,type:"POST",data:n}).done(function(e){e.success?window.location.reload(!0):i.removeAttr("disabled"),WP_Weixin.debug&&window.console.log(e)}).fail(function(e,i){WP_Weixin.debug&&window.console.log(i)})});var i=!1;function n(e){var i={nonce:a("#wp_weixin_qr_nonce").val(),action:"wp_weixin_get_"+e+"_qr"},n=a(".wp-weixin-qr-code"),o=a("#wp_weixin_hash");a.ajax({url:WP_Weixin.ajax_url,type:"POST",data:i}).done(function(e){e.success?(n.attr("src",e.data.qrSrc),n.css("visibility","visible"),o.val(e.data.hash),a(".desktop-qr-content .message").show(),a(".waiting").show(),window.scanListenerStart()):(n.css("visibility","hidden"),n.attr("src",""),o.val(""),window.scanListenerStop())}).fail(function(e,i){WP_Weixin.debug&&window.console.log(i)})}a(".wp-weixin-wechat-auth").length&&(i="auth"),a(".wp-weixin-wechat-bind").length&&(i="bind"),i&&(n(i),a(".refresh").on("click",function(e){e.preventDefault(),n(i)}),window.registerScanSuccessListener(function(e){a(".waiting").hide(),a(".success").show(),WP_Weixin.debug&&console.log(e),e.redirect&&(a(".success .redirect-message").show(),setTimeout(function(){window.location=e.redirect},4e3))}),window.registerScanFailureListener(function(e){a(".waiting").hide(),a(".failure").show(),a(".error").show(),a(".wp-weixin-qr-code").css("visibility","hidden"),a.each(e.error,function(e,i){a(".error").append("<br/>"+i+"<br/>")}),WP_Weixin.debug&&console.log(e),e.redirect&&(a(".failure .redirect-message").show(),setTimeout(function(){window.location=e.redirect},4e3))}),window.registerBeatSuccessListener(function(e){a(".network-on").show(),a(".network-off").hide(),WP_Weixin.debug&&console.log(e)}),window.registerBeatFailureListener(function(e){a(".network-on").hide(),a(".network-off").show(),WP_Weixin.debug&&console.log(e)}))}),window.wpWeixinShareTimelineSuccessTrigger=function(e){window.wpWeixinShareTimelineSuccess=new CustomEvent("wpWeixinShareTimelineSuccess",{detail:e}),window.dispatchEvent(window.wpWeixinShareTimelineSuccess)},window.wpWeixinShareTimelineFailureTrigger=function(e){window.wpWeixinShareTimelineFailure=new CustomEvent("wpWeixinShareTimelineFailure",{detail:e}),window.dispatchEvent(window.wpWeixinShareTimelineFailure)},window.wpWeixinShareAppMessageSuccessTrigger=function(e){window.wpWeixinShareAppMessageSuccess=new CustomEvent("wpWeixinShareAppMessageSuccess",{detail:e}),window.dispatchEvent(window.wpWeixinShareAppMessageSuccess)},window.wpWeixinShareAppMessageFailureTrigger=function(e){window.wpWeixinShareAppMessageFailure=new CustomEvent("wpWeixinShareAppMessageFailure",{detail:e}),window.dispatchEvent(window.wpWeixinShareAppMessageFailure)},window.wpWeixinShareTimelineSuccessListener=function(i){window.addEventListener("wpWeixinShareTimelineSuccess",function(e){"function"==typeof i&&i(e.detail)})},window.wpWeixinShareTimelineFailureListener=function(i){window.addEventListener("wpWeixinShareTimelineFailure",function(e){"function"==typeof i&&i(e.detail)})},window.wpWeixinShareAppMessageSuccessListener=function(i){window.addEventListener("wpWeixinShareAppMessageSuccess",function(e){"function"==typeof i&&i(e.detail)})},window.wpWeixinShareAppMessageFailureListener=function(i){window.addEventListener("wpWeixinShareAppMessageFailure",function(e){"function"==typeof i&&i(e.detail)})},wx.config({appId:WP_Weixin.weixin.appid,timestamp:WP_Weixin.weixin.timestamp,nonceStr:WP_Weixin.weixin.nonceStr,signature:WP_Weixin.weixin.signature,jsApiList:["updateTimelineShareData","updateAppMessageShareData","startRecord","stopRecord","onVoiceRecordEnd","playVoice","pauseVoice","stopVoice","onVoicePlayEnd","uploadVoice","downloadVoice","chooseImage","previewImage","uploadImage","downloadImage","translateVoice","getNetworkType","openLocation","getLocation","hideOptionMenu","showOptionMenu","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","closeWindow","scanQRCode","addCard","chooseCard","openCard"]}),wx.ready(function(){a(document.body).trigger("wp_weixin_ready"),a(".wechat-close").on("click",function(e){e.preventDefault(),wx.closeWindow()}),a(document.body).on("wp_weixin_share_update",function(){WP_Weixin.share&&(wx.updateTimelineShareData({title:WP_Weixin.share.title,link:WP_Weixin.share.link,imgUrl:WP_Weixin.share.imgUrl,success:function(){window.wpWeixinShareTimelineSuccessTrigger(WP_Weixin.share)},cancel:function(){window.wpWeixinShareTimelineFailureTrigger(WP_Weixin.share)}}),wx.updateAppMessageShareData({title:WP_Weixin.share.title,desc:WP_Weixin.share.desc,link:WP_Weixin.share.link,imgUrl:WP_Weixin.share.imgUrl,success:function(){window.wpWeixinShareAppMessageSuccessTrigger(WP_Weixin.share)},cancel:function(){window.wpWeixinShareAppMessageFailureTrigger(WP_Weixin.share)}}))}),a(document.body).trigger("wp_weixin_share_update")})});